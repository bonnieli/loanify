<div id="Stat" style="display:inline-block; background-color:white; width:100%">
  <h3 style="text-align:center;width:100%;">My Profile</h3>
  <details id='stat_summary'>
  <summary>Statistic</summary>
  <p id="stat_paragraph"> </p>
  </details>
  </br>
</div>

<div id="BalanceHistory" style="height: 260px; width: 100%;"></div>
<div id="CurrentOutstanding_d" style="height: 260px; width: 100%;"></div>
<div id="CurrentOutstanding_ar" style="height: 260px; width: 100%;"></div>
<div id="History_d" style="height: 260px; width: 100%;"></div>

<%= javascript_include_tag "canvasjs", "data-turbolinks-track" => true %>
<%= javascript_include_tag "canvasjs.min", "data-turbolinks-track" => true %>
<%= javascript_include_tag "excanvas", "data-turbolinks-track" => true %>

<script>
  var raw_all_charts = <%= raw CGI.unescapeHTML(@all_charts) %>;

  $(document).ready(function () {
    var lst_stat = raw_all_charts.Stat
    var str_stat = "";
    str_stat = str_stat + "Average Paidback Time: " + lst_stat.Average_Paidback_Time  + "<br>";
    str_stat = str_stat + "Total number of outstanding UOI: " + lst_stat.Outstanding_AR + "<br>";
    str_stat = str_stat + "Total number of outstanding IOU: " + lst_stat.Outstanding_Debt + "<br>";
    str_stat = str_stat + "UOI/IOU Ratio: " + lst_stat.Outstanding_Ratio;
    str_stat = str_stat + "Total number of UOI rejected transactions: " + lst_stat.Transactions_Gotten_Rejected + "<br>";
    str_stat = str_stat + "Total number of IOU rejected transaction: " + lst_stat.Transactions_Rejected + "<br>";
    str_stat = str_stat + "Total number of paidback transaction: " + lst_stat.Transactions_PaidBack + "<br>";
    $("#stat_summary").open=true;
    $("#stat_paragraph").html(str_stat);
  });

  //Balance History -- Line Chart
  var dp_BalanceHistory = function(datas) {
    var dataPoints = [];
    $.each(datas, function(i, data) {
      dataPoints.push({ x: new Date(data.StartDate), y: data.Amount});
    });
    return dataPoints;
  };
  
  var c_BalanceHistory = new CanvasJS.Chart("BalanceHistory",
    {
      title:{text: "Account Balance History"},
      axisX: {
              title: "Date",
              valueFormatString: "MM/DD",
              interval:1,
              intervalType: "day"},
      axisY:{
              title: "Amount",
              includeZero: true},
      legend:{
              fontSize: 15,
              verticalAlign: "bottom",
              horizontalAlign: "center"},
      data: [{
              type: "line",
              legendText: "IOU",
              xValueType: "dateTime",
              xValueFormatString: "MM/DD",
              showInLegend: true,
              dataPoints: dp_BalanceHistory(raw_all_charts.DebtLevel_d)
            },
            {
              type: "line",
              legendText: "UOI",
              xValueType: "dateTime",
              xValueFormatString: "MM/DD",
              showInLegend: true,
              dataPoints: dp_BalanceHistory(raw_all_charts.DebtLevel_ar)
            }
      ]
    });
  c_BalanceHistory.render();

  //Current Outstanding Debt & AR -- Pie Chart
  var dp_CurrentOutstanding = function(datas) {
    var dataPoints = [];
    $.each(datas, function(i, data) {
      dataPoints.push({ y: data.Amount, indexLabel: data.First_Name + ' ' + data.Last_Name});
    });
    return dataPoints;
  };
  
  var c_CurrentOutstanding_d = new CanvasJS.Chart("CurrentOutstanding_d",
    {
      title:{text: "Current Balance IOU"},
      data: [{
              type: "pie",
              dataPoints: dp_CurrentOutstanding(raw_all_charts.Pie_d)
            }
      ]
    });
  c_CurrentOutstanding_d.render();

  var c_CurrentOutstanding_ar = new CanvasJS.Chart("CurrentOutstanding_ar",
    {
      title:{text: "Current Balance UOI"},
      data: [{
              type: "pie",
              dataPoints: dp_CurrentOutstanding(raw_all_charts.Pie_ar)
            }
      ]
    });
  c_CurrentOutstanding_ar.render();


  //History Debt & AR -- Bubble Chart
    //Transaction History -- Bubble Chart
  var dp_TransactionHistory = function(datas) {
    var dataPoints = [];
    $.each(datas, function(i, data) {
      dataPoints.push({ x: new Date(data.StartDate), y: data.Paidback_Time, z: data.Amount, name: data.First_name});
    });
    return dataPoints;
  };
  
  var c_TransactionHistory = new CanvasJS.Chart("History_d",
    {
      title:{text: "Completed UOI Transaction History"},
      axisX:{
              title: "Date",
              valueFormatString: "MM/DD",
              intervalType: "day",
              interval: 7,
      },
      axisY:{
              title: "Payback Time" 
              },
      legend:{
              fontSize: 15,
              verticalAlign: "bottom",
              horizontalAlign: "center"},
      data: [{
              type: "bubble",
              showInLegend: true,
              legendText: "Size of Bubble represents amount",
              dataPoints: dp_TransactionHistory(raw_all_charts.History_d)
      }]
   
  });
  c_TransactionHistory.render();

</script>